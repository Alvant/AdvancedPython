# Lab 20. Python + SQL

Дана схема базы данных, как в прошлой лабе (http://cs.mipt.ru/advanced_python/lessons/lab19.html):

* *Book*(id, author, title, publish_year)
* *Reader*(id, name)
* *Record*(reader_id, book_id, taking_date, returning_date)

В табличку *Record* можно добавить и отдельный ID.
А `reader_id` и `book_id` — внешние ключи, которые ссылаются на таблицы *Reader* и *Book* соответственно.


## Задание 1

Основное задание — в приведено в конце последней лабы (http://cs.mipt.ru/advanced_python/lessons/lab20.html).

Используя базу данных с предыдущего занятия, надо написать класс (или набор функций) для работы с ней.
Должны быть реализованы возможности:

1. Вывести список книг
1. Вывести список читателей
1. Добавить книгу.
1. Добавить читателя.
1. Выдать книгу читателю
1. Принять книгу.

По желанию можно дополнительно добавить поддержку произвольных запросов.


## Задание 2*

В качестве дополнительного задания предлагается реализовать ещё пару запросов:

* Кто из читателей чаще всего берёт книги?
* Какую книгу чаще всего берут читать?
* Какую книгу в среднем дольше всего читают?
* Было ли такое, что в некоторый момент один читатель имел на руках больше одной книги? Если да, надо вывести список людей.
* Было ли так, что одна книга была на руках одновременно у двух и более читателей? (Книга — то есть книга с данным ID.) Если да, надо вывести список таких книг. (Понятно, в реальной жизни книжка не могла "раздвоиться", но, может, в базу данных заносили неправильные значения?)
* Как можно изменить базу данных, чтобы предотвратить возможность ситуации, как в случае выше?
* Для каждой пары людей посчитать, сколько раз они приходили в библиотеку в один день.
* Для каждой пары людей оценить неслучайность их совместного прихода в библиотеку. Например, можно воспользоваться [PMI](https://en.wikipedia.org/wiki/Pointwise_mutual_information): пусть *N* — сколько всего дней работала библиотека, *N<sub>a</sub>* — число дней, когда в библиотеку приходил человек A, *N<sub>b</sub>* — число дней, когда в библиотеку приходил человек B, а *N<sub>ab</sub>* — количество дней, когда в библиотеку приходили и A, и B. Тогда оценить, что люди A и B неслучайно ходят в библиотеку в один и тот же день, можно так
<p align="center">
    <img src="./images/not_by_accident.svg" title="\frac{NN_{ab}}{N_a N_b}" />
</p>
